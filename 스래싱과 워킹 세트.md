# Operating System

## Charpter 07 가상 기억 장치 관리

### 1. 스래싱(thrashing) 개요

- 스래싱이란 너무 자주 페이지 교체가 일어나는 현상을 말하는 것으로, 어떤 프로세스가 계속적으로 페이지 부재가 발생하여 프로세스의 처리 시간보다 페이지 교체 시간이 더 많아지는 현상을 말한다.

![다중프로그래밍차수](https://user-images.githubusercontent.com/38815618/87249996-32d5bf80-c49d-11ea-8dc2-ab3cb45e8854.jpg)

- 위에서 부터 각각의 기억 장치가 3MB, 2MB, 1MB라고 할 때, 1MB -> 3MB로 늘리는 것보다, 1 -> 2MB로 늘리는 것이 효율적인 투자 결정이다.

### 2. 스래싱의 원인

- 실제로 사용하는 수만큼의 충분한 페이지 프레임을 갖지 못했을 때 페이지 부재가 빈번하게 발생하며, 이때 실행 중인 프로세스는 계속 페이지 교체를 수행해야 하기 때문에 스래싱 현상이 발생한다.

![스래싱](https://user-images.githubusercontent.com/38815618/87249994-31a49280-c49d-11ea-9f20-c8e0ccc9e456.jpg)

- 일반적으로 다중 프로그래밍의 정도가 높아짐에 따라 CPU의 이용률도 최대값이 될 때까지 높아지지만, 어느 순간에 스래싱 현상이 일어나 CPU의 이용률이 급격히 감소한다.
- 스래싱을 방지하려면 다중 프로그래밍 정도를 낮추어야 한다.
  - 각 프로세스들에게 충분한 페이지 프레임을 할당할 수 있게 해주거나, 주기억 장치 내에 작업 집합(working set)를 제대로 유지해야 한다.

### 3. 구역성(locality)

- 구역성은 프로세스가 실행되는 동안 기억 장치 내의 모든 정보를 균일하게 참조하는 것이 아니라 현재 실행되는 주소 부근에서 국부적인 부분만을 집중적으로 참조한다는 의미이다.
- 시간 구역성(temporal locality)
  - 최근에 참조된 기억 장소가 가까운 장래에도 계속 참조될 가능성이 높음을 의미한다.
  - 순환(looping), 서브 루틴, 스택, 카운팅(counting)과 집계(totaling) 등이 있다.
- 공간 구역성(spatial locality)
  - 일단 하나의 기억 장소가 참조되면 그 근처의 기억 장소가 계속 참조되는 경향이 있음을 의미한다.
  - 배열 순례(array traversal), 순차적 코드의 실행, 프로그래머들이 서로 관련된 변수들을 근처에 선언한 떄 등이 있다.

### 4. 작업 집합(working set)

- 실행중인 프로세스가 일정 시간 동안에 참조하는 페이지들의 집합을 의미한다.
  - 프로그램이 효율적으로 수행되려면 해당 프로그램의 워킹 세트가 주기억 장치 내에 유지되어야 한다.
    - 만약 그렇지 않으면 보조 기억 장치로부터 계속 페이지를 요구하게 되므로 스래싱 현상이 발생할 수 있다.
- 페이지 작업 집합 W(t, w) 정의
  - 프로세스 간격이라 부르는 시간 t에서 w사이에 사용된 페이지의 집합이다.
  - 여기서 변수 w는 작업 집합의 윈도 사이즈라 한다.
- 작업 집합의 크기
  - 윈도 사이즈 w가 증가함에 따라 변하는 작업 집합의 크기를 보여 준다.
- 처음에 프로세스는 그의 워킹 세트에 하나씩 페이지를 추가하게 되며 그 프로세스는 점진적으로 작업 집합을 수용할 수 있는 만큼의 기억 장치를 할당받는다.
- 프로세스가 실행되면서 다음 작업 집합으로 전이가 발생한다.
- 전이 발생 초기에는 프로세스가 새로운 페이지를 계속 요구하므로 곡선은 증가 상태를 보인다.

### 5. 페이지 교체 시 고려 사항

#### 전역 대 지역 교체

- 전역 교체(global replacement)
  - 프로세스가 교체할 프레임을 그 프레임이 현재 다른 프로세스에게 할당되어 있어도 상관없이 전체 프레임 중에서 하나를 선택해 그 프레임을 사용할 수 있게 해주는 방법으로 자신의 페이지 부재율을 조정할 수 없다.
  - 전역 교체 알고리즘은 한 프로세스가 다른 프로세스에 할당된 프레임 중에서도 선택이 가능하기 때문에 해당 프로세스에 할당된 프레임의 수는 증가한다.
- 지역 교체(local replacement)
  - 각 프로세스가 그 프로세스에 할당된 프레임 중에서 하나를 선택해 그 프레임을 사용할 수 있게 해주는 방법으로, 한 프로세스의 기억 장치 내의 페이지 집합은 단지 그 프로세스의 페이지 기법의 동작에만 영향을 받는다.
  - 지역 교체 알고리즘은 각 프로세스에 할당된 프레임들 중에서 선택하므로 프로세스에 할당된 프레임의 수는 변하지 않는다.

#### 프리 페이징(예상 페이징)

- 프리 페이징 또는 예상 페이징은 최초의 과도한 페이지 부재를 방지하려고 예상되는 모든 페이지를 사전에 한꺼번에 기억 장치 내로 가져오는 기법이다.
- 프리 페이징에 사용되는 비용이 페이지 부재를 해결하는데 필요한 비용보다 더 많은지, 적은지를 잘 고려해야 한다.

#### 페이지 크기

- 페이지 크기가 작으면 작을 수록 테이블 단편화가 발생한다.
  - 페이지 크기가 작을 수록 더 많은 페이지와 페이지 프레임이 생기고, 이를 관리하기 위한 페이지 사상표의 크기가 증가하여 기억 공간이 낭비되며, 이러한 기억 낭비 현상을 테이블 단편화(table fragmentation)라 한다.
- 페이지 크기가 커지면 마지막 페이지가 절반 정도 낭비된다.
- 페이지 크기가 클수록 디스크로부터의 전송 시간이 감소된다.
- 페이지가 작게 되면 총입출력 양은 감소된다.
- 페이지가 크면 페이지 부재가 감소된다.
