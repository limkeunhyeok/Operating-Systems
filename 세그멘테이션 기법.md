# Operating System

## Charpter 06 주기억 장치 관리

### 1. 세그멘테이션 가상 주소 변환

- 페이징은 프로세스를 물리적으로 일정한 크기로 나눠서 메모리에 할당하는 것이라면, 세그멘테이션은 프로세스를 논리적 내용을 기반으로 나눠서 메모리에 배치하는 것을 말한다.
- 세그멘테이션의 가상 주소는 (세그먼트 번호, 변위)의 순서쌍으로 구성된다.
  - 세그먼트 번호는 주기억 장치에 적재될 기본 위치의 간접 참조이다.
  - 변위(displacement)는 오프셋(offset)이라고도 하며 세그먼트 안에서 목적 셀의 주소를 가리킨다.
- 세그먼트 이름 공간은 두 가지 공간 요소여서 가상 주소 변환을 다음과 같은 형식으로 한다.

![가상주소변환형식](https://user-images.githubusercontent.com/38815618/87127297-ac688480-c2c8-11ea-9e0d-015ddbec6b47.PNG)

- 임의의 이름 공간 참조는 다음과 같은 형식을 갖는다.

![이름공간참조](https://user-images.githubusercontent.com/38815618/87127285-aa062a80-c2c8-11ea-9ff8-eb6250cd515b.PNG)

- i는 세그먼트 주소, j는 세그먼트 안의 오프셋, k는 세그먼트가 적재될 주기억 장소의 실제 주소이다.
- 세그먼트 이름(segmentName)과 오프셋 이름(offsetName)은 파일 이름처럼 전형적인 심볼 이름으로, 런타임에 해석되고 바인딩된다.
  - 이는 프로세스로 하여금 심볼 참조로 프로그램을 사용할 수 있게 한다.
- 주소 변환은 다음과 같은 형태를 갖는다.

![주소변환](https://user-images.githubusercontent.com/38815618/87127290-ab375780-c2c8-11ea-85f9-7c79a04fb4a9.PNG)

- 여기서 segmentName은 실행 이미지로 컴파일될 목적 세그먼트의 심볼이다.
- 세그먼트 안의 오프셋 이름은 런타임 때에 번역되어 바인딩된다.
- 목적지 세그먼트 오프셋은 컴파일러와 링커가 심볼로 정의할 수 있다.
- 세그먼테이션의 가상 주소 변환은 다음과 같이 된다.

![가상주소변환](https://user-images.githubusercontent.com/38815618/87127294-ac688480-c2c8-11ea-9bad-a2bedd0dd9ba.PNG)

- 여기서 segmentName은 심볼 세그먼트 이름이고, offsetName은 그 세그먼트의 진입점(entry point) 이름과 같은 심볼이다.
- 운영 체제는 각 프로세스의 세그먼트 테이블을 유지하면서, 다음의 그림과 같이 세그멘테이션 주소 변환 과정을 거친다.

![주소변환과정](https://user-images.githubusercontent.com/38815618/87127291-abcfee00-c2c8-11ea-849d-b1d7f60dc6a9.PNG)

- 세그먼트 테이블: 프로세스가 실행되는 동안 주기억 장치에 저장되며 세그먼트의 기본 주소, 경계, 보호 레지스터 내용을 담고있다. 여기서 기본 주소 필드는 목적 세그먼트의 세그먼트 재배치 레지스터를 가지고 있고, 경계 필드는 세그먼트 길이 레지스터를 가지고 있으며, 보호 필드는 세그먼트에 접근 권한 정보를 가지고 있다.
- S-map: 세그먼트 이름을 세그먼트 번호로 번역한다.
- N-map: 심볼 오프셋을 수치 오프셋으로 번역한다.
- 세그먼트 테이블 기준 레지스터(Segment Table Base Register, STBR): 주기억 장치 내 세그먼트 테이블의 위치를 나타낸다.
- 세그먼트 테이블 길이 레지스터(Segment Table Length Register, STLR): 세그먼트 테이블 전체 길이를 나타낸다.

### 2. 세그멘테이션 주소 변환 예

![주소변환예](https://user-images.githubusercontent.com/38815618/87127292-abcfee00-c2c8-11ea-80ef-544bcee97755.PNG)

- 실행되는 프로세스는 가상 주로 G = (s, d)를 참조하여, 세그먼트 이름 s에 세그먼트 사상표 기준 레지스터 STBR과 더해져 주기억 장치의 세그먼트가 시작되는 주소인 s'를 얻는다.
- 주소 변환 Bt는 s'와 오프셋 dㄹㄹ 더하여 물리 주소(실주소) k = s' + d를 얻는다.

### 3. 세그먼트 시스템에서의 공유

- 세그먼트 기법은 합리적인 한계 내에서 필요한 크기를 갖게 허용한다.
- 세그먼트 시스템에서 한 세그먼트의 공유가 일단 선언되면 자료 구조는 그것이 공유된 세그먼트에 속한다는 논리적 사실의 변동 없이 마음대로 늘어나거나 줄어들 수 있다.

![세그먼트시스템공유](https://user-images.githubusercontent.com/38815618/87127298-ad011b00-c2c8-11ea-9f77-4aeab8daebd9.PNG)

- 두 프로세스 P1과 P2는 자신의 세그먼트 테이블에 같은 세그먼트 주소를 가짐으로써 주기억 장치 내에서 그 세그먼트를 공유한다.
