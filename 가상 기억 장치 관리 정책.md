# Operating System

## Charpter 07 가상 기억 장치 관리

### 1. 배경

- 실제 프로그램이 수행되는 시점에서 프로그램 전체가 한꺼번에 주기억 장치에 적재되어 있어야 할 필요가 없다.
  - 프로그램에는 잘 발생하지 않는 오류 조건(error condition)을 처리하는 코드가 있지만, 실제로 이러한 오류들은 거의 발생하지 않으며, 발생해도 이 오류코드는 실행되지 않는다.
  - 배열, 리스트, 테이블 등은 실제로 요구되는 기억 공간보다 더 많은 기억 공간이 할당된다.
- 프로그램을 분할하여 모듈 단위로 기억 공간에 저장시켜 수행할 수 있다면 많은 이점을 얻을 수 있다.
  - 프로그램들은 실제로 물리적인 기억 공간에 의해 더 이상 제약을 받지 않는다.
  - 각 사용자들은 물리적인 기억 공간을 적게 차지하므로 더 많은 프로그램들을 똑같은 시간에 수행시킬 수 있다.
  - 각 사용자 프로그램들이 기억 장치에 적재 또는 교체 되기 위해 필요한 입출력들이 적어지므로 각 사용자 프로그램들은 더 빨리 수행될 수 있다.

### 2. 반입 정책(fetch strategic)

- 반입 정책은  CPU에 의해 실행되거나 참조되기 위해서, 적재할 프로그램이나 자료를 언제 주기억 장치로 가져올 것인가를 결정하는 문제이다.

#### 요구 페이징(demand paging)

- 요구 페이징은 어떤 프로그램이나 자료가 실행되거나 참조되는 시점에 특정 페이지나 세그먼트를 주기억 장치로 이동시키는 것을 가리킨다.
  - 요구가 있을 때 교체하며, 동시에 모든 페이지를 교체하지 않는다.
- 요구 페이징은 주기억 장치에 실행할 프로세스의 페이지가 전혀 없어도 프로세스 수행이 가능하다.
  - 프로세스는 최소의 명령으로 페이지 부재를 일으켜 페이지가 메모리로 들어오게 한다.
- 요구 페이징 기법의 장점
  - 액세스되지 않은 페이지를 적재하지 않아 메모리가 절약된다.
  - 어느 페이지를 옮길지를 결정하는 데 있어서 오버헤드가 적다.
  - 적은 수의 페이지를 읽으므로 초기 디스크 오버헤드가 적다.
  - 페이지 부재율이 비교적 낮을 때, 하나의 프로세스에 할당되는 프레임의 수를 감소시키려고 사용될 수 있어, 다중 프로그래밍의 정도와 그 시스템의 CPU 이용도를 증가시킨다.
  - 프로그램을 실행할 충분한 기억 장치가 없는 시스템에서도 대용량 프로그램을 실행 가능하여, 프로그래머는 오버레이 기법보다 쉽게 구현 가능하다.
- 요구 페이징 기법의 단점
  - 페이지를 할당받으려면 대기 시간이 길다.
  - 개별 프로그램들은 페이지에 처음 접근할 때 약간의 지연이 발생한다.
  - 저비용, 저성능의 시스템에 실행되는 프로그램은 페이지 대체를 지원하는 기억 장치 관리 장치가 없다.
  - 기억 장치 관리(페이지 교체)가 복잡하다.

#### 예상 페이징(anticipatory paging)

- 예상 페이징은 현 프로그램 수행 중에 앞으로 CPU가 참조할 가능성이 높은 자료 또는 프로그램을 예상하여 운영 체제가 미리 주기억 장치로 옮기는 방법을 가리킨다.
- 예상 페이징 기법의 장점
  - 예측 결정이 맞으면 프로세스의 실행 시간은 대단히 감소된다.
  - 만약 정확한 결정이라면 다른 프로세스 실행에 영향을 주지 않는다.
  - 하드웨어의 가격 하락으로 옳지 못한 결정의 결과도 그리 심각하지 않다.
- 예상 페이징 기법의 단점
  - 어느 페이지를 주기억 장치로 옮길지 결정하는 데 있어서의 오버헤드가 크다.
  - 사용 가능성이 높은 페이지를 사전에 선정하는 것이 현실적으로 힘들다.
    - 이를 해결하기 위한 방법이 국부성(locality) 원리이다.

### 3. 교체 정책(replacement strategy)

- 교체 정책은 CPU가 참고하는 페이지를 주기억 장치에 적재하기 위해서, 어떤 페이지를 주기억 장치로부터 제거할 것인가를 결정하는 정책이다.
- 교체 정책에서 페이지 부재가 발생하면, 운영 체제가 들어올 페이지 공간을 만들어 주려고 주기억 장치로부터 제거할 페이지를 선택한다.
  - 만약 제거되는 페이지가 기억 장치에 있는 동안 변경되었다면, 그 페이지는 디스크에 재기록되어야 한다.

#### 최적 교체(optimal replacement)

- Belady가 제안한 것으로, 앞으로 가장 오랜 기간 동안 사용되지 않을 페이지를 교체시키는 것을 말한다.
- 최적 교체의 특징
  - FIFO의 모순을 피할 수 있는 알고리즘(최소의 페이지 부재율을 가지는 알고리즘)이다.
  - 페이지 호출 순서의 모든 상황을 사전에 미리 파악하고 있어야 하므로 다루기가 어렵고 비현실적이다.

#### 무작위 페이지 교체(random page replacement)

- 특별한 사용자들에게 차이를 두지 않고 페이지를 교체하는 기법으로, 교체할 페이지를 무작위로 선택한다.
- 무작위 페이지 교체의 특징
  - 오버헤드가 적은 페이지 교체 기법이다.
  - 최악의 때에 바로 뒤에 호출될 페이지도 교체될 수 있다.

#### FIFO(First In First Out)

- 각 페이지가 주기억 장치로 들어올 때마다 time-stamp를 찍어 그 시간을 기억하고 있다가 페이지가 교체될 필요가 있을 때 가장 먼저 주기억 장치에 들어와 있는 페이지와 교체시키는 방법을 말한다.
- FIFO의 특징
  - 이해하기 쉽고 설계가 간단하다.
  - 중요한 페이지가 오랫동안 페이지 프레임을 차지하였다는 이유로 교체되어야 하는 불합리성이 있다.
    - 오래 있었던 페이지는 앞으로 계속 사용될 가능성이 있다.

#### 2차 기회(Second chance) 교체

- FIFO 방식의 단점인 오랫동안 있었고 자주 쓰이던 페이지가 대체될 수 있다는 것을 막으려는 방법으로, 모든 페이지들의 참조 비트를 두어 참조 비트가 1이면 피드백시켜 유지하고 0인 페이지만 교체하는 방법이다.

![2차기회페이지](https://user-images.githubusercontent.com/38815618/87228281-2be67880-c3db-11ea-8fa6-331b94024673.PNG)

- 처음 모든 참조 비트를 0으로 설정하고 한 프로세스가 수행되면서 참조한 각 페이지와 관계된 참조 비트는 1로 바뀐다.
  - 이 참조 비트의 값을 조사함으로써 페이지의 사용 여부를 판단하여, 참조 비트가 0인 페이지를 교체하고 1인 비트를 0으로 설정한 다음 큐로 피드백시킴으로써 그 페이지에 두 번째 기회를 준다.
  - 결국 참조 비트가 1인 한 계속 주기억 장치 내에 머물게 된다.

#### LRU(Least Recently Used)

- LRU 교체 알고리즘은 가장 널리 사용하는 방법으로, 한 프로세스에서 사용되는 각 페이지마다 카운터를 두어 현 시점에서 가장 오랫동안 사용되지 않은 페이지를 제거하는 방법이다.
  - 최근 상황이 가까운 미래의 좋은 척도라는 경험적인 국부성(지역성)에 의존한다.
  - 오랜 기간 참조되지 않은 페이지라면 가까운 장래에도 역시 사용되지 않을 거라는 가정에 근거한 방법이다.
- LRU의 특징
  - 페이지를 불러왔던 시간을 기록해야 하므로, 시간 오버헤드가 발생한다.
  - 실제로는 구현하기가 매우 복잡하다.

#### LFU(Least Frequence Used)

- 사용 빈도가 가장 낮은 페이지 즉, 호출된 횟수가 가장 적은 페이지를 교체하는 방법이다.
- LFU의 특징
  - 바로 불러 온 페이지가 교체될 수 있다.

#### NUR(Not Used Recently)

- LRU 교체의 단점인 시간 오버헤드를 해결하기 위한 방법으로, 최근에 사용되지 않은 페이지를 교체하는 것으로써 2개의 비트를 둔다.
- 2개의 비트는 참조 비트와 변형 비트로 나뉜다.
- 2개의 비트 표
- 초기의 참조 비트와 변형 비트는 모두 0으로 설정되고, 참조 또는 변형이 되었을 때 1로 세트된다.
- 하나의 페이지를 교체하고자 할 때는 참조 비트가 0인 페이지를 찾는다.
  - 만일 모든 참조 비트가 1일 경우, 변형 비트가 0인 것을 찾는다.
    - 변형 비트가 1일 때 그 페이지를 보조 기억 장치에 저장시켜야 하는 부담이 발생하기 때문이다.
- 다중 사용자 시스템에서는 주기적으로 모든 참조 비트를 0으로 세트시킨다.
  - 모든 참조 비트가 1이 되기 쉽기 때문에 교체에 적합한 페이지를 식별하기 힘들기 때문이다.
- 드물지만 현재 실행 중인 페이지도 교체할 수 있는 약점이 있다.
